{"ast":null,"code":"import { initialLoad } from '../base/constant';\nimport { RenderType } from '../base/enum';\nimport { VirtualContentRenderer, VirtualHeaderRenderer } from '../renderer/virtual-content-renderer';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { extend, getValue, isNullOrUndefined, remove } from '@syncfusion/ej2-base';\nimport { setComplexFieldID, setValidationRuels, getColumnModelByUid } from '../base/util';\n/**\n * Virtual Scrolling class\n */\n\nvar VirtualScroll =\n/** @class */\nfunction () {\n  function VirtualScroll(parent, locator) {\n    this.parent = parent;\n    this.locator = locator;\n    this.addEventListener();\n  }\n\n  VirtualScroll.prototype.getModuleName = function () {\n    return 'virtualscroll';\n  };\n\n  VirtualScroll.prototype.instantiateRenderer = function () {\n    this.parent.log(['limitation', 'virtual_height'], 'virtualization');\n    var renderer = this.locator.getService('rendererFactory');\n\n    if (!this.parent.isFrozenGrid()) {\n      if (this.parent.enableColumnVirtualization) {\n        renderer.addRenderer(RenderType.Header, new VirtualHeaderRenderer(this.parent, this.locator));\n      }\n\n      renderer.addRenderer(RenderType.Content, new VirtualContentRenderer(this.parent, this.locator));\n    }\n\n    this.ensurePageSize();\n  };\n\n  VirtualScroll.prototype.ensurePageSize = function () {\n    var rowHeight = this.parent.getRowHeight();\n    var vHeight = this.parent.height.toString().indexOf('%') < 0 ? this.parent.height : this.parent.element.getBoundingClientRect().height;\n    this.blockSize = ~~(vHeight / rowHeight);\n    var height = this.blockSize * 2;\n    var size = this.parent.pageSettings.pageSize;\n    this.parent.setProperties({\n      pageSettings: {\n        pageSize: size < height ? height : size\n      }\n    }, true);\n  };\n\n  VirtualScroll.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(initialLoad, this.instantiateRenderer, this);\n    this.parent.on(events.columnWidthChanged, this.refreshVirtualElement, this);\n    this.parent.on(events.createVirtualValidationForm, this.createVirtualValidationForm, this);\n    this.parent.on(events.validateVirtualForm, this.virtualEditFormValidation, this);\n    this.parent.on(events.destroy, this.destroy, this);\n  };\n\n  VirtualScroll.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(initialLoad, this.instantiateRenderer);\n    this.parent.off(events.columnWidthChanged, this.refreshVirtualElement);\n    this.parent.off(events.createVirtualValidationForm, this.createVirtualValidationForm);\n    this.parent.off(events.validateVirtualForm, this.virtualEditFormValidation);\n    this.parent.off(events.destroy, this.destroy);\n  };\n\n  VirtualScroll.prototype.getCurrentEditedData = function (prevData) {\n    var data = {\n      virtualData: extend({}, {}, prevData, true),\n      isAdd: false,\n      isScroll: false,\n      endEdit: true\n    };\n    this.parent.notify(events.getVirtualData, data);\n    return data.virtualData;\n  };\n\n  VirtualScroll.prototype.createVirtualValidationForm = function (e) {\n    var gObj = this.parent;\n\n    if (gObj.enableVirtualization && gObj.editSettings.mode === 'Normal') {\n      var cols = gObj.columns;\n      var rowRenderer = new RowRenderer(this.locator, null, this.parent);\n      var rowObj = extend({}, {}, gObj.getRowObjectFromUID(e.uid), true);\n      gObj.notify(events.refreshVirtualEditFormCells, rowObj);\n      var args = e.argsCreator(this.getCurrentEditedData(e.prevData), {}, false);\n      args.isCustomFormValidation = true;\n      args.row = rowRenderer.render(rowObj, cols);\n      e.renderer.update(args);\n      var rules = {};\n\n      for (var i = 0; i < cols.length; i++) {\n        if (!cols[i].visible) {\n          continue;\n        }\n\n        if (cols[i].validationRules) {\n          setValidationRuels(cols[i], 0, rules, {}, {}, cols.length, true);\n        }\n      }\n\n      args.form.classList.add('e-virtual-validation');\n      gObj.editModule.virtualFormObj = gObj.editModule.createFormObj(args.form, rules);\n    }\n  };\n\n  VirtualScroll.prototype.virtualEditFormValidation = function (args) {\n    var gObj = this.parent;\n    var error = gObj.element.querySelector('.e-griderror:not([style*=\"display: none\"])');\n\n    if (gObj.editModule.virtualFormObj) {\n      if (error && error.style.display !== 'none') {\n        var errorDomRect = error.getBoundingClientRect();\n        var forms = gObj.element.querySelectorAll('.e-gridform');\n        var form = forms[0];\n        var contentLeft = gObj.getContent().getBoundingClientRect().left;\n\n        if (forms.length > 1) {\n          form = gObj.getFrozenMode() !== 'Right' ? forms[1] : forms[0];\n          contentLeft = gObj.getMovableVirtualContent().getBoundingClientRect().left;\n        }\n\n        if (errorDomRect.left < contentLeft || errorDomRect.right > gObj.element.offsetWidth) {\n          var tooltip = form.querySelector('.e-tooltip-wrap:not([style*=\"display: none\"])');\n          this.scrollToEdit(tooltip, {\n            editIdx: args.editIdx,\n            addIdx: args.addIdx\n          }, true);\n        }\n      } else if (gObj.editModule.virtualFormObj && (!error || error.style.display === 'none')) {\n        var existingErrors = gObj.editModule.virtualFormObj.element.querySelectorAll('.e-tooltip-wrap:not([style*=\"display: none\"])');\n\n        for (var i = 0; i < existingErrors.length; i++) {\n          remove(existingErrors[i]);\n        }\n\n        this.setEditedDataToValidationForm(gObj.editModule.virtualFormObj.element, this.getCurrentEditedData(args.prevData));\n        args.isValid = gObj.editModule.virtualFormObj.validate();\n\n        if (!args.isValid) {\n          var tooltip = gObj.editModule.virtualFormObj.element.querySelector('.e-tooltip-wrap:not([style*=\"display: none\"])');\n          this.scrollToEdit(tooltip, {\n            editIdx: args.editIdx,\n            addIdx: args.addIdx\n          });\n        }\n      }\n    }\n  };\n\n  VirtualScroll.prototype.scrollToEdit = function (tooltip, args, isRenderer) {\n    var gObj = this.parent;\n\n    if (tooltip) {\n      var cols = gObj.columnModel;\n      var field = setComplexFieldID(tooltip.id).split('_')[0];\n      var col = gObj.getColumnByField(field);\n      var scrollTop = this.parent.getContent().firstElementChild.scrollTop;\n      var row = gObj.getRowByIndex(args.editIdx);\n\n      if (isRenderer || !col || !isNullOrUndefined(args.addIdx) && scrollTop > 0 || !isNullOrUndefined(args.editIdx) && !row) {\n        var validationCol = void 0;\n\n        for (var i = 0; i < cols.length && !col; i++) {\n          if (cols[i].field === field) {\n            validationCol = cols[i];\n            break;\n          }\n        }\n\n        if (isRenderer) {\n          validationCol = col;\n        }\n\n        this.parent.notify(events.scrollToEdit, validationCol);\n      }\n    }\n  };\n\n  VirtualScroll.prototype.setEditedDataToValidationForm = function (form, editedData) {\n    var inputs = [].slice.call(form.getElementsByClassName('e-field'));\n\n    for (var i = 0, len = inputs.length; i < len; i++) {\n      var col = getColumnModelByUid(this.parent, inputs[i].getAttribute('e-mappinguid'));\n      var value = getValue(col.field, editedData);\n      value = isNullOrUndefined(value) ? '' : value;\n      inputs[i].value = value;\n    }\n  };\n\n  VirtualScroll.prototype.refreshVirtualElement = function (args) {\n    if (this.parent.enableColumnVirtualization && args.module === 'resize') {\n      var renderer = this.locator.getService('rendererFactory');\n      renderer.getRenderer(RenderType.Content).refreshVirtualElement();\n    }\n  };\n\n  VirtualScroll.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  return VirtualScroll;\n}();\n\nexport { VirtualScroll };","map":{"version":3,"sources":["C:/Users/khang/OneDrive/Tài liệu/JS/PersonalDashdoard/dashboard/node_modules/@syncfusion/ej2-react-grids/node_modules/@syncfusion/ej2-grids/src/grid/actions/virtual-scroll.js"],"names":["initialLoad","RenderType","VirtualContentRenderer","VirtualHeaderRenderer","events","RowRenderer","extend","getValue","isNullOrUndefined","remove","setComplexFieldID","setValidationRuels","getColumnModelByUid","VirtualScroll","parent","locator","addEventListener","prototype","getModuleName","instantiateRenderer","log","renderer","getService","isFrozenGrid","enableColumnVirtualization","addRenderer","Header","Content","ensurePageSize","rowHeight","getRowHeight","vHeight","height","toString","indexOf","element","getBoundingClientRect","blockSize","size","pageSettings","pageSize","setProperties","isDestroyed","on","columnWidthChanged","refreshVirtualElement","createVirtualValidationForm","validateVirtualForm","virtualEditFormValidation","destroy","removeEventListener","off","getCurrentEditedData","prevData","data","virtualData","isAdd","isScroll","endEdit","notify","getVirtualData","e","gObj","enableVirtualization","editSettings","mode","cols","columns","rowRenderer","rowObj","getRowObjectFromUID","uid","refreshVirtualEditFormCells","args","argsCreator","isCustomFormValidation","row","render","update","rules","i","length","visible","validationRules","form","classList","add","editModule","virtualFormObj","createFormObj","error","querySelector","style","display","errorDomRect","forms","querySelectorAll","contentLeft","getContent","left","getFrozenMode","getMovableVirtualContent","right","offsetWidth","tooltip","scrollToEdit","editIdx","addIdx","existingErrors","setEditedDataToValidationForm","isValid","validate","isRenderer","columnModel","field","id","split","col","getColumnByField","scrollTop","firstElementChild","getRowByIndex","validationCol","editedData","inputs","slice","call","getElementsByClassName","len","getAttribute","value","module","getRenderer"],"mappings":"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","sourcesContent":["import { initialLoad } from '../base/constant';\nimport { RenderType } from '../base/enum';\nimport { VirtualContentRenderer, VirtualHeaderRenderer } from '../renderer/virtual-content-renderer';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { extend, getValue, isNullOrUndefined, remove } from '@syncfusion/ej2-base';\nimport { setComplexFieldID, setValidationRuels, getColumnModelByUid } from '../base/util';\n/**\n * Virtual Scrolling class\n */\nvar VirtualScroll = /** @class */ (function () {\n    function VirtualScroll(parent, locator) {\n        this.parent = parent;\n        this.locator = locator;\n        this.addEventListener();\n    }\n    VirtualScroll.prototype.getModuleName = function () {\n        return 'virtualscroll';\n    };\n    VirtualScroll.prototype.instantiateRenderer = function () {\n        this.parent.log(['limitation', 'virtual_height'], 'virtualization');\n        var renderer = this.locator.getService('rendererFactory');\n        if (!this.parent.isFrozenGrid()) {\n            if (this.parent.enableColumnVirtualization) {\n                renderer.addRenderer(RenderType.Header, new VirtualHeaderRenderer(this.parent, this.locator));\n            }\n            renderer.addRenderer(RenderType.Content, new VirtualContentRenderer(this.parent, this.locator));\n        }\n        this.ensurePageSize();\n    };\n    VirtualScroll.prototype.ensurePageSize = function () {\n        var rowHeight = this.parent.getRowHeight();\n        var vHeight = this.parent.height.toString().indexOf('%') < 0 ? this.parent.height :\n            this.parent.element.getBoundingClientRect().height;\n        this.blockSize = ~~(vHeight / rowHeight);\n        var height = this.blockSize * 2;\n        var size = this.parent.pageSettings.pageSize;\n        this.parent.setProperties({ pageSettings: { pageSize: size < height ? height : size } }, true);\n    };\n    VirtualScroll.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(initialLoad, this.instantiateRenderer, this);\n        this.parent.on(events.columnWidthChanged, this.refreshVirtualElement, this);\n        this.parent.on(events.createVirtualValidationForm, this.createVirtualValidationForm, this);\n        this.parent.on(events.validateVirtualForm, this.virtualEditFormValidation, this);\n        this.parent.on(events.destroy, this.destroy, this);\n    };\n    VirtualScroll.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(initialLoad, this.instantiateRenderer);\n        this.parent.off(events.columnWidthChanged, this.refreshVirtualElement);\n        this.parent.off(events.createVirtualValidationForm, this.createVirtualValidationForm);\n        this.parent.off(events.validateVirtualForm, this.virtualEditFormValidation);\n        this.parent.off(events.destroy, this.destroy);\n    };\n    VirtualScroll.prototype.getCurrentEditedData = function (prevData) {\n        var data = {\n            virtualData: extend({}, {}, prevData, true), isAdd: false, isScroll: false, endEdit: true\n        };\n        this.parent.notify(events.getVirtualData, data);\n        return data.virtualData;\n    };\n    VirtualScroll.prototype.createVirtualValidationForm = function (e) {\n        var gObj = this.parent;\n        if (gObj.enableVirtualization && gObj.editSettings.mode === 'Normal') {\n            var cols = gObj.columns;\n            var rowRenderer = new RowRenderer(this.locator, null, this.parent);\n            var rowObj = extend({}, {}, gObj.getRowObjectFromUID(e.uid), true);\n            gObj.notify(events.refreshVirtualEditFormCells, rowObj);\n            var args = e.argsCreator(this.getCurrentEditedData(e.prevData), {}, false);\n            args.isCustomFormValidation = true;\n            args.row = rowRenderer.render(rowObj, cols);\n            e.renderer.update(args);\n            var rules = {};\n            for (var i = 0; i < cols.length; i++) {\n                if (!cols[i].visible) {\n                    continue;\n                }\n                if (cols[i].validationRules) {\n                    setValidationRuels(cols[i], 0, rules, {}, {}, cols.length, true);\n                }\n            }\n            args.form.classList.add('e-virtual-validation');\n            gObj.editModule.virtualFormObj = gObj.editModule.createFormObj(args.form, rules);\n        }\n    };\n    VirtualScroll.prototype.virtualEditFormValidation = function (args) {\n        var gObj = this.parent;\n        var error = gObj.element.querySelector('.e-griderror:not([style*=\"display: none\"])');\n        if (gObj.editModule.virtualFormObj) {\n            if (error && error.style.display !== 'none') {\n                var errorDomRect = error.getBoundingClientRect();\n                var forms = gObj.element.querySelectorAll('.e-gridform');\n                var form = forms[0];\n                var contentLeft = gObj.getContent().getBoundingClientRect().left;\n                if (forms.length > 1) {\n                    form = gObj.getFrozenMode() !== 'Right' ? forms[1] : forms[0];\n                    contentLeft = gObj.getMovableVirtualContent().getBoundingClientRect().left;\n                }\n                if (errorDomRect.left < contentLeft || errorDomRect.right > gObj.element.offsetWidth) {\n                    var tooltip = form.querySelector('.e-tooltip-wrap:not([style*=\"display: none\"])');\n                    this.scrollToEdit(tooltip, { editIdx: args.editIdx, addIdx: args.addIdx }, true);\n                }\n            }\n            else if (gObj.editModule.virtualFormObj && (!error || error.style.display === 'none')) {\n                var existingErrors = gObj.editModule.virtualFormObj.element.querySelectorAll('.e-tooltip-wrap:not([style*=\"display: none\"])');\n                for (var i = 0; i < existingErrors.length; i++) {\n                    remove(existingErrors[i]);\n                }\n                this.setEditedDataToValidationForm(gObj.editModule.virtualFormObj.element, this.getCurrentEditedData(args.prevData));\n                args.isValid = gObj.editModule.virtualFormObj.validate();\n                if (!args.isValid) {\n                    var tooltip = gObj.editModule.virtualFormObj.element.querySelector('.e-tooltip-wrap:not([style*=\"display: none\"])');\n                    this.scrollToEdit(tooltip, { editIdx: args.editIdx, addIdx: args.addIdx });\n                }\n            }\n        }\n    };\n    VirtualScroll.prototype.scrollToEdit = function (tooltip, args, isRenderer) {\n        var gObj = this.parent;\n        if (tooltip) {\n            var cols = gObj.columnModel;\n            var field = setComplexFieldID(tooltip.id).split('_')[0];\n            var col = gObj.getColumnByField(field);\n            var scrollTop = this.parent.getContent().firstElementChild.scrollTop;\n            var row = gObj.getRowByIndex(args.editIdx);\n            if (isRenderer || !col || (!isNullOrUndefined(args.addIdx) && scrollTop > 0) || (!isNullOrUndefined(args.editIdx) && !row)) {\n                var validationCol = void 0;\n                for (var i = 0; i < cols.length && !col; i++) {\n                    if (cols[i].field === field) {\n                        validationCol = cols[i];\n                        break;\n                    }\n                }\n                if (isRenderer) {\n                    validationCol = col;\n                }\n                this.parent.notify(events.scrollToEdit, validationCol);\n            }\n        }\n    };\n    VirtualScroll.prototype.setEditedDataToValidationForm = function (form, editedData) {\n        var inputs = [].slice.call(form.getElementsByClassName('e-field'));\n        for (var i = 0, len = inputs.length; i < len; i++) {\n            var col = getColumnModelByUid(this.parent, inputs[i].getAttribute('e-mappinguid'));\n            var value = getValue(col.field, editedData);\n            value = isNullOrUndefined(value) ? '' : value;\n            inputs[i].value = value;\n        }\n    };\n    VirtualScroll.prototype.refreshVirtualElement = function (args) {\n        if (this.parent.enableColumnVirtualization && args.module === 'resize') {\n            var renderer = this.locator.getService('rendererFactory');\n            renderer.getRenderer(RenderType.Content).refreshVirtualElement();\n        }\n    };\n    VirtualScroll.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    return VirtualScroll;\n}());\nexport { VirtualScroll };\n"]},"metadata":{},"sourceType":"module"}