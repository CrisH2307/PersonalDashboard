{"ast":null,"code":"import { isNullOrUndefined, closest } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as cls from '../base/css-constant';\n/**\n * Kanban CRUD module\n */\n\nvar Crud =\n/** @class */\nfunction () {\n  /**\n   * Constructor for CRUD module\n   *\n   * @param {Kanban} parent Accepts the kanban instance\n   * @private\n   */\n  function Crud(parent) {\n    this.parent = parent;\n  }\n\n  Crud.prototype.addCard = function (cardData, index) {\n    var _this = this;\n\n    var args = {\n      cancel: false,\n      requestType: 'cardCreate',\n      addedRecords: cardData instanceof Array ? cardData : [cardData],\n      changedRecords: [],\n      deletedRecords: []\n    };\n    this.parent.trigger(events.actionBegin, args, function (addArgs) {\n      if (!addArgs.cancel) {\n        var modifiedData_1 = [];\n\n        if (_this.parent.sortSettings.field && _this.parent.sortSettings.sortBy === 'Index') {\n          if (cardData instanceof Array) {\n            modifiedData_1 = cardData;\n          } else {\n            modifiedData_1.push(cardData);\n          }\n\n          modifiedData_1.forEach(function (data, index) {\n            if (!data[_this.parent.sortSettings.field]) {\n              var columnData = _this.parent.getColumnData(data[_this.parent.keyField]);\n\n              if (_this.parent.sortSettings.direction === 'Ascending' && columnData.length > 0) {\n                data[_this.parent.sortSettings.field] = columnData[columnData.length - 1][_this.parent.sortSettings.field] + index + 1;\n              } else if (_this.parent.sortSettings.direction === 'Descending' && columnData.length > 0) {\n                data[_this.parent.sortSettings.field] = columnData[0][_this.parent.sortSettings.field] + index + 1;\n              }\n\n              if (columnData.length === 0) {\n                data[_this.parent.sortSettings.field] = 1;\n              }\n            }\n          });\n\n          if (!(cardData instanceof Array)) {\n            if (!index && _this.parent.sortSettings.direction === 'Descending') {\n              _this.parent.getColumnData(modifiedData_1[0][_this.parent.keyField]).filter(function (obj, count) {\n                if (obj[_this.parent.sortSettings.field] === modifiedData_1[0][_this.parent.sortSettings.field]) {\n                  index = count + 1;\n                }\n              });\n            }\n          }\n\n          if (index !== 0 && !index && _this.parent.sortSettings.direction === 'Descending') {\n            index = 0;\n          }\n\n          modifiedData_1 = _this.priorityOrder(modifiedData_1, index);\n        }\n\n        var addedRecords = cardData instanceof Array ? cardData : [cardData];\n        var changedRecords = _this.parent.sortSettings.field && _this.parent.sortSettings.sortBy === 'Index' ? modifiedData_1 : [];\n        var editParms = {\n          addedRecords: addedRecords,\n          changedRecords: changedRecords,\n          deletedRecords: []\n        };\n        var type = cardData instanceof Array || modifiedData_1.length > 0 ? 'batch' : 'insert';\n\n        _this.parent.dataModule.updateDataManager(type, editParms, 'cardCreated', cardData, index);\n      }\n    });\n  };\n\n  Crud.prototype.getIndexFromData = function (data) {\n    var cardElement = this.parent.element.querySelector(\".\" + cls.CARD_CLASS + \"[data-id=\\\"\" + data[this.parent.cardSettings.headerField] + \"\\\"]\");\n    var element = closest(cardElement, '.' + cls.CONTENT_CELLS_CLASS);\n    var index = [].slice.call(element.querySelectorAll('.' + cls.CARD_CLASS)).indexOf(cardElement);\n    return index;\n  };\n\n  Crud.prototype.updateCard = function (cardData, index) {\n    var _this = this;\n\n    var args = {\n      requestType: 'cardChange',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: cardData instanceof Array ? cardData : [cardData],\n      deletedRecords: []\n    };\n    index = isNullOrUndefined(index) ? this.getIndexFromData(args.changedRecords[0]) : index;\n    this.parent.trigger(events.actionBegin, args, function (updateArgs) {\n      if (!updateArgs.cancel) {\n        if (_this.parent.sortSettings.field && _this.parent.sortSettings.sortBy === 'Index') {\n          var modifiedData = [];\n\n          if (cardData instanceof Array) {\n            modifiedData = cardData;\n          } else {\n            modifiedData.push(cardData);\n          }\n\n          cardData = _this.priorityOrder(modifiedData, index);\n        }\n\n        var editParms = {\n          addedRecords: [],\n          changedRecords: cardData instanceof Array ? cardData : [cardData],\n          deletedRecords: []\n        };\n        var type = cardData instanceof Array ? 'batch' : 'update';\n\n        _this.parent.dataModule.updateDataManager(type, editParms, 'cardChanged', cardData, index);\n      }\n    });\n  };\n\n  Crud.prototype.deleteCard = function (cardData) {\n    var _this = this;\n\n    var editParms = {\n      addedRecords: [],\n      changedRecords: [],\n      deletedRecords: []\n    };\n\n    if (typeof cardData === 'string' || typeof cardData === 'number') {\n      editParms.deletedRecords = this.parent.kanbanData.filter(function (data) {\n        return data[_this.parent.cardSettings.headerField] === cardData;\n      });\n    } else {\n      editParms.deletedRecords = cardData instanceof Array ? cardData : [cardData];\n    }\n\n    var args = {\n      requestType: 'cardRemove',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: [],\n      deletedRecords: editParms.deletedRecords\n    };\n    this.parent.trigger(events.actionBegin, args, function (deleteArgs) {\n      if (!deleteArgs.cancel) {\n        var type = editParms.deletedRecords.length > 1 ? 'batch' : 'delete';\n        var cardData_1 = editParms.deletedRecords;\n\n        _this.parent.dataModule.updateDataManager(type, editParms, 'cardRemoved', cardData_1[0]);\n      }\n    });\n  };\n\n  Crud.prototype.priorityOrder = function (cardData, cardIndex) {\n    var _this = this;\n\n    var cardsId = cardData.map(function (obj) {\n      return obj[_this.parent.cardSettings.headerField];\n    });\n    var num = cardData[cardData.length - 1][this.parent.sortSettings.field];\n    var allModifiedKeys = cardData.map(function (obj) {\n      return obj[_this.parent.keyField];\n    });\n    var modifiedKey = allModifiedKeys.filter(function (key, index) {\n      return allModifiedKeys.indexOf(key) === index;\n    }).sort();\n    var columnAllDatas;\n    var finalData = [];\n    var originalIndex = [];\n\n    var _loop_1 = function (columnKey) {\n      var keyData = cardData.filter(function (cardObj) {\n        return cardObj[_this.parent.keyField] === columnKey;\n      });\n      columnAllDatas = this_1.parent.layoutModule.getColumnData(columnKey);\n\n      for (var _i = 0, _a = keyData; _i < _a.length; _i++) {\n        var data = _a[_i];\n\n        if (this_1.parent.swimlaneSettings.keyField) {\n          var swimlaneDatas = this_1.parent.getSwimlaneData(data[this_1.parent.swimlaneSettings.keyField]);\n          columnAllDatas = this_1.parent.getColumnData(columnKey, swimlaneDatas);\n        }\n      }\n\n      keyData.forEach(function (key) {\n        return finalData.push(key);\n      });\n\n      if (!isNullOrUndefined(cardIndex)) {\n        var _loop_2 = function (j) {\n          columnAllDatas.filter(function (data, index) {\n            if (data[_this.parent.cardSettings.headerField] === cardsId[j] && index <= cardIndex) {\n              originalIndex.push(index);\n            }\n          });\n        };\n\n        for (var j = 0; j < cardsId.length; j++) {\n          _loop_2(j);\n        }\n\n        if (originalIndex.length > 0) {\n          cardIndex = cardIndex + originalIndex.length;\n        }\n\n        if (this_1.parent.sortSettings.direction === 'Ascending') {\n          for (var i = cardIndex; i < columnAllDatas.length; i++) {\n            if (cardsId.indexOf(columnAllDatas[i][this_1.parent.cardSettings.headerField]) === -1) {\n              columnAllDatas[i][this_1.parent.sortSettings.field] = ++num;\n              finalData.push(columnAllDatas[i]);\n            }\n          }\n        } else {\n          for (var i = cardIndex - 1; i >= 0; i--) {\n            if (cardsId.indexOf(columnAllDatas[i][this_1.parent.cardSettings.headerField]) === -1) {\n              columnAllDatas[i][this_1.parent.sortSettings.field] = ++num;\n              finalData.push(columnAllDatas[i]);\n            }\n          }\n        }\n      }\n    };\n\n    var this_1 = this;\n\n    for (var _i = 0, modifiedKey_1 = modifiedKey; _i < modifiedKey_1.length; _i++) {\n      var columnKey = modifiedKey_1[_i];\n\n      _loop_1(columnKey);\n    }\n\n    return finalData;\n  };\n\n  return Crud;\n}();\n\nexport { Crud };","map":{"version":3,"sources":["C:/Users/khang/OneDrive/Tài liệu/JS/PersonalDashdoard/dashboard/node_modules/@syncfusion/ej2-kanban/src/kanban/actions/crud.js"],"names":["isNullOrUndefined","closest","events","cls","Crud","parent","prototype","addCard","cardData","index","_this","args","cancel","requestType","addedRecords","Array","changedRecords","deletedRecords","trigger","actionBegin","addArgs","modifiedData_1","sortSettings","field","sortBy","push","forEach","data","columnData","getColumnData","keyField","direction","length","filter","obj","count","priorityOrder","editParms","type","dataModule","updateDataManager","getIndexFromData","cardElement","element","querySelector","CARD_CLASS","cardSettings","headerField","CONTENT_CELLS_CLASS","slice","call","querySelectorAll","indexOf","updateCard","updateArgs","modifiedData","deleteCard","kanbanData","deleteArgs","cardData_1","cardIndex","cardsId","map","num","allModifiedKeys","modifiedKey","key","sort","columnAllDatas","finalData","originalIndex","_loop_1","columnKey","keyData","cardObj","this_1","layoutModule","_i","_a","swimlaneSettings","swimlaneDatas","getSwimlaneData","_loop_2","j","i","modifiedKey_1"],"mappings":"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","sourcesContent":["import { isNullOrUndefined, closest } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as cls from '../base/css-constant';\n/**\n * Kanban CRUD module\n */\nvar Crud = /** @class */ (function () {\n    /**\n     * Constructor for CRUD module\n     *\n     * @param {Kanban} parent Accepts the kanban instance\n     * @private\n     */\n    function Crud(parent) {\n        this.parent = parent;\n    }\n    Crud.prototype.addCard = function (cardData, index) {\n        var _this = this;\n        var args = {\n            cancel: false, requestType: 'cardCreate', addedRecords: (cardData instanceof Array) ? cardData : [cardData],\n            changedRecords: [], deletedRecords: []\n        };\n        this.parent.trigger(events.actionBegin, args, function (addArgs) {\n            if (!addArgs.cancel) {\n                var modifiedData_1 = [];\n                if (_this.parent.sortSettings.field && _this.parent.sortSettings.sortBy === 'Index') {\n                    if (cardData instanceof Array) {\n                        modifiedData_1 = cardData;\n                    }\n                    else {\n                        modifiedData_1.push(cardData);\n                    }\n                    modifiedData_1.forEach(function (data, index) {\n                        if (!data[_this.parent.sortSettings.field]) {\n                            var columnData = _this.parent.getColumnData(data[_this.parent.keyField]);\n                            if (_this.parent.sortSettings.direction === 'Ascending' && columnData.length > 0) {\n                                data[_this.parent.sortSettings.field] = (columnData[columnData.length - 1][_this.parent.sortSettings.field]) + index + 1;\n                            }\n                            else if (_this.parent.sortSettings.direction === 'Descending' && columnData.length > 0) {\n                                data[_this.parent.sortSettings.field] = columnData[0][_this.parent.sortSettings.field] + index + 1;\n                            }\n                            if (columnData.length === 0) {\n                                data[_this.parent.sortSettings.field] = 1;\n                            }\n                        }\n                    });\n                    if (!(cardData instanceof Array)) {\n                        if (!index && _this.parent.sortSettings.direction === 'Descending') {\n                            _this.parent.getColumnData(modifiedData_1[0][_this.parent.keyField]).filter(function (obj, count) {\n                                if (obj[_this.parent.sortSettings.field] === modifiedData_1[0][_this.parent.sortSettings.field]) {\n                                    index = count + 1;\n                                }\n                            });\n                        }\n                    }\n                    if (index !== 0 && !index && _this.parent.sortSettings.direction === 'Descending') {\n                        index = 0;\n                    }\n                    modifiedData_1 = _this.priorityOrder(modifiedData_1, index);\n                }\n                var addedRecords = (cardData instanceof Array) ? cardData : [cardData];\n                var changedRecords = (_this.parent.sortSettings.field && _this.parent.sortSettings.sortBy === 'Index') ? modifiedData_1 : [];\n                var editParms = { addedRecords: addedRecords, changedRecords: changedRecords, deletedRecords: [] };\n                var type = (cardData instanceof Array || modifiedData_1.length > 0) ? 'batch' : 'insert';\n                _this.parent.dataModule.updateDataManager(type, editParms, 'cardCreated', cardData, index);\n            }\n        });\n    };\n    Crud.prototype.getIndexFromData = function (data) {\n        var cardElement = this.parent.element.querySelector(\".\" + cls.CARD_CLASS + \"[data-id=\\\"\" + data[this.parent.cardSettings.headerField] + \"\\\"]\");\n        var element = closest(cardElement, '.' + cls.CONTENT_CELLS_CLASS);\n        var index = [].slice.call(element.querySelectorAll('.' + cls.CARD_CLASS)).indexOf(cardElement);\n        return index;\n    };\n    Crud.prototype.updateCard = function (cardData, index) {\n        var _this = this;\n        var args = {\n            requestType: 'cardChange', cancel: false, addedRecords: [],\n            changedRecords: (cardData instanceof Array) ? cardData : [cardData], deletedRecords: []\n        };\n        index = isNullOrUndefined(index) ? this.getIndexFromData(args.changedRecords[0]) : index;\n        this.parent.trigger(events.actionBegin, args, function (updateArgs) {\n            if (!updateArgs.cancel) {\n                if (_this.parent.sortSettings.field && _this.parent.sortSettings.sortBy === 'Index') {\n                    var modifiedData = [];\n                    if (cardData instanceof Array) {\n                        modifiedData = cardData;\n                    }\n                    else {\n                        modifiedData.push(cardData);\n                    }\n                    cardData = _this.priorityOrder(modifiedData, index);\n                }\n                var editParms = {\n                    addedRecords: [], changedRecords: (cardData instanceof Array) ? cardData : [cardData], deletedRecords: []\n                };\n                var type = (cardData instanceof Array) ? 'batch' : 'update';\n                _this.parent.dataModule.updateDataManager(type, editParms, 'cardChanged', cardData, index);\n            }\n        });\n    };\n    Crud.prototype.deleteCard = function (cardData) {\n        var _this = this;\n        var editParms = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n        if (typeof cardData === 'string' || typeof cardData === 'number') {\n            editParms.deletedRecords = this.parent.kanbanData.filter(function (data) {\n                return data[_this.parent.cardSettings.headerField] === cardData;\n            });\n        }\n        else {\n            editParms.deletedRecords = (cardData instanceof Array) ? cardData : [cardData];\n        }\n        var args = {\n            requestType: 'cardRemove', cancel: false, addedRecords: [], changedRecords: [], deletedRecords: editParms.deletedRecords\n        };\n        this.parent.trigger(events.actionBegin, args, function (deleteArgs) {\n            if (!deleteArgs.cancel) {\n                var type = (editParms.deletedRecords.length > 1) ? 'batch' : 'delete';\n                var cardData_1 = editParms.deletedRecords;\n                _this.parent.dataModule.updateDataManager(type, editParms, 'cardRemoved', cardData_1[0]);\n            }\n        });\n    };\n    Crud.prototype.priorityOrder = function (cardData, cardIndex) {\n        var _this = this;\n        var cardsId = cardData.map(function (obj) { return obj[_this.parent.cardSettings.headerField]; });\n        var num = cardData[cardData.length - 1][this.parent.sortSettings.field];\n        var allModifiedKeys = cardData.map(function (obj) { return obj[_this.parent.keyField]; });\n        var modifiedKey = allModifiedKeys.filter(function (key, index) { return allModifiedKeys.indexOf(key) === index; }).sort();\n        var columnAllDatas;\n        var finalData = [];\n        var originalIndex = [];\n        var _loop_1 = function (columnKey) {\n            var keyData = cardData.filter(function (cardObj) {\n                return cardObj[_this.parent.keyField] === columnKey;\n            });\n            columnAllDatas = this_1.parent.layoutModule.getColumnData(columnKey);\n            for (var _i = 0, _a = keyData; _i < _a.length; _i++) {\n                var data = _a[_i];\n                if (this_1.parent.swimlaneSettings.keyField) {\n                    var swimlaneDatas = this_1.parent.getSwimlaneData(data[this_1.parent.swimlaneSettings.keyField]);\n                    columnAllDatas = this_1.parent.getColumnData(columnKey, swimlaneDatas);\n                }\n            }\n            keyData.forEach(function (key) { return finalData.push(key); });\n            if (!isNullOrUndefined(cardIndex)) {\n                var _loop_2 = function (j) {\n                    columnAllDatas.filter(function (data, index) {\n                        if (data[_this.parent.cardSettings.headerField] === cardsId[j] && index <= cardIndex) {\n                            originalIndex.push(index);\n                        }\n                    });\n                };\n                for (var j = 0; j < cardsId.length; j++) {\n                    _loop_2(j);\n                }\n                if (originalIndex.length > 0) {\n                    cardIndex = cardIndex + originalIndex.length;\n                }\n                if (this_1.parent.sortSettings.direction === 'Ascending') {\n                    for (var i = cardIndex; i < columnAllDatas.length; i++) {\n                        if (cardsId.indexOf(columnAllDatas[i][this_1.parent.cardSettings.headerField]) === -1) {\n                            columnAllDatas[i][this_1.parent.sortSettings.field] = ++num;\n                            finalData.push(columnAllDatas[i]);\n                        }\n                    }\n                }\n                else {\n                    for (var i = cardIndex - 1; i >= 0; i--) {\n                        if (cardsId.indexOf(columnAllDatas[i][this_1.parent.cardSettings.headerField]) === -1) {\n                            columnAllDatas[i][this_1.parent.sortSettings.field] = ++num;\n                            finalData.push(columnAllDatas[i]);\n                        }\n                    }\n                }\n            }\n        };\n        var this_1 = this;\n        for (var _i = 0, modifiedKey_1 = modifiedKey; _i < modifiedKey_1.length; _i++) {\n            var columnKey = modifiedKey_1[_i];\n            _loop_1(columnKey);\n        }\n        return finalData;\n    };\n    return Crud;\n}());\nexport { Crud };\n"]},"metadata":{},"sourceType":"module"}