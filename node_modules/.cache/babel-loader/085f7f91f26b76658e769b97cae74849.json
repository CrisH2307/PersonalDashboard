{"ast":null,"code":"/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { extend } from '@syncfusion/ej2-base';\nimport { DataManager, Query, Deferred, UrlAdaptor } from '@syncfusion/ej2-data';\nimport * as events from './constant';\n/**\n * Kanban data module\n */\n\nvar Data =\n/** @class */\nfunction () {\n  /**\n   * Constructor for data module\n   *\n   * @param {Kanban} parent Accepts the instance of the Kanban\n   */\n  function Data(parent) {\n    this.dataState = {\n      isPending: false,\n      resolver: null,\n      isDataChanged: false\n    };\n    this.parent = parent;\n    this.keyField = this.parent.cardSettings.headerField;\n    this.dataState = {\n      isDataChanged: false\n    };\n    this.isObservable = false;\n    this.initDataManager(parent.dataSource, parent.query);\n    this.refreshDataManager();\n  }\n  /**\n   * The function used to initialize dataManager` and query\n   *\n   * @param {Object[] | DataManager} dataSource Accepts the dataSource as collection of objects or Datamanager instance.\n   * @param {Query} query Accepts the query to process the data from collections.\n   * @returns {void}\n   * @private\n   */\n\n\n  Data.prototype.initDataManager = function (dataSource, query) {\n    this.dataManager = dataSource instanceof DataManager ? dataSource : new DataManager(dataSource);\n    this.query = query instanceof Query ? query : new Query();\n    this.kanbanData = new DataManager(this.parent.kanbanData);\n  };\n  /**\n   * The function used to generate updated Query from schedule model\n   *\n   * @returns {void}\n   * @private\n   */\n\n\n  Data.prototype.getQuery = function () {\n    return this.query.clone();\n  };\n  /**\n   * The function used to get dataSource by executing given Query\n   *\n   * @param  {Query} query - A Query that specifies to generate dataSource\n   * @returns {void}\n   * @private\n   */\n\n\n  Data.prototype.getData = function (query) {\n    if (this.parent.dataSource && 'result' in this.parent.dataSource) {\n      var def = this.eventPromise({\n        requestType: ''\n      }, query);\n      this.isObservable = true;\n      return def.promise;\n    }\n\n    return this.dataManager.executeQuery(query);\n  };\n\n  Data.prototype.setState = function (state) {\n    return this.dataState = state;\n  };\n\n  Data.prototype.getStateEventArgument = function (query) {\n    var adaptr = new UrlAdaptor();\n    var dm = new DataManager({\n      url: '',\n      adaptor: new UrlAdaptor()\n    });\n    var state = adaptr.processQuery(dm, query);\n    var data = JSON.parse(state.data);\n    return extend(data, state.pvtData);\n  };\n\n  Data.prototype.eventPromise = function (args, query, index) {\n    var _this = this;\n\n    var dataArgs = args;\n    var state = this.getStateEventArgument(query);\n    var def = new Deferred();\n    var deff = new Deferred();\n\n    if (args.requestType !== undefined && this.dataState.isDataChanged !== false) {\n      state.action = args;\n\n      if (args.requestType === 'cardChanged' || args.requestType === 'cardRemoved' || args.requestType === 'cardCreated') {\n        var editArgs_1 = args;\n        editArgs_1.promise = deff.promise;\n        editArgs_1.state = state;\n        editArgs_1.index = index;\n        this.setState({\n          isPending: true,\n          resolver: deff.resolve\n        });\n        dataArgs.endEdit = deff.resolve;\n        dataArgs.cancelEdit = deff.reject;\n        this.parent.trigger(events.dataSourceChanged, editArgs_1);\n        deff.promise.then(function () {\n          _this.setState({\n            isPending: true,\n            resolver: def.resolve\n          });\n\n          _this.parent.trigger(events.dataStateChange, state);\n\n          editArgs_1.addedRecords.forEach(function (data) {\n            _this.parent.kanbanData.push(data);\n          });\n          editArgs_1.changedRecords.forEach(function (changedRecord) {\n            var cardObj = _this.parent.kanbanData.filter(function (data) {\n              return data[_this.parent.cardSettings.headerField] === changedRecord[_this.parent.cardSettings.headerField];\n            })[0];\n\n            extend(cardObj, changedRecord);\n          });\n          editArgs_1.deletedRecords.forEach(function (deletedRecord) {\n            var index = _this.parent.kanbanData.findIndex(function (data) {\n              return data[_this.parent.cardSettings.headerField] === deletedRecord[_this.parent.cardSettings.headerField];\n            });\n\n            _this.parent.kanbanData.splice(index, 1);\n          });\n        }).catch(function () {\n          _this.parent.hideSpinner();\n\n          void 0;\n        });\n      } else {\n        this.setState({\n          isPending: true,\n          resolver: def.resolve\n        });\n        this.parent.trigger(events.dataStateChange, state);\n      }\n    } else {\n      this.setState({});\n      def.resolve(this.parent.dataSource);\n    }\n\n    return def;\n  };\n  /**\n   * The function used to get the table name from the given Query\n   *\n   * @returns {string} Returns the table name.\n   * @private\n   */\n\n\n  Data.prototype.getTable = function () {\n    if (this.parent.query) {\n      var query = this.getQuery();\n      return query.fromTable;\n    } else {\n      return null;\n    }\n  };\n  /**\n   * The function is used to send the request and get response from datamanager\n   *\n   * @returns {void}\n   * @private\n   */\n\n\n  Data.prototype.refreshDataManager = function () {\n    var _this = this;\n\n    var dataManager = this.getData(this.getQuery());\n    dataManager.then(function (e) {\n      return _this.dataManagerSuccess(e);\n    }).catch(function (e) {\n      return _this.dataManagerFailure(e);\n    });\n  };\n  /**\n   * The function is used to handle the success response from dataManager\n   *\n   * @param {ReturnType} e Accepts the dataManager success result\n   * @returns {void}\n   * @private\n   */\n\n\n  Data.prototype.dataManagerSuccess = function (e, type, offlineArgs, index) {\n    var _this = this;\n\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    if (type) {\n      var resultData = extend([], e.result, null, true);\n      this.parent.kanbanData = resultData;\n\n      if (offlineArgs.requestType === 'cardCreated') {\n        if (!Array.isArray(e)) {\n          offlineArgs.addedRecords[0] = extend(offlineArgs.addedRecords[0], e);\n        } else {\n          this.modifyArrayData(offlineArgs.addedRecords, e);\n        }\n      } else if (offlineArgs.requestType === 'cardChanged') {\n        if (!Array.isArray(e)) {\n          offlineArgs.changedRecords[0] = extend(offlineArgs.changedRecords[0], e);\n        } else {\n          this.modifyArrayData(offlineArgs.changedRecords, e);\n        }\n      } else if (offlineArgs.requestType === 'cardRemoved') {\n        if (!Array.isArray(e)) {\n          offlineArgs.deletedRecords[0] = extend(offlineArgs.deletedRecords[0], e);\n        } else {\n          this.modifyArrayData(offlineArgs.deletedRecords, e);\n        }\n      }\n\n      this.refreshUI(offlineArgs, index);\n    } else {\n      this.parent.trigger(events.dataBinding, e, function (args) {\n        var resultData = extend([], args.result, null, true);\n        _this.parent.kanbanData = resultData;\n\n        _this.parent.notify(events.dataReady, {\n          processedData: resultData\n        });\n\n        _this.parent.trigger(events.dataBound, null, function () {\n          return _this.parent.hideSpinner();\n        });\n      });\n    }\n  };\n  /**\n   * The function is used to handle the failure response from dataManager\n   *\n   * @param {ReturnType} e Accepts the dataManager failure result\n   * @returns {void}\n   * @private\n   */\n\n\n  Data.prototype.dataManagerFailure = function (e) {\n    var _this = this;\n\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.trigger(events.actionFailure, {\n      error: e\n    }, function () {\n      return _this.parent.hideSpinner();\n    });\n  };\n  /**\n   * The function is used to perform the insert, update, delete and batch actions in datamanager\n   *\n   * @param {string} updateType Accepts the update type action\n   * @param {SaveChanges} params Accepts the savechanges params\n   * @param {string} type Accepts the requestType as string\n   * @param {Object} data Accepts the data to perform crud action\n   * @param {number} index Accepts the index to refresh the data into UI\n   * @returns {void}\n   * @private\n   */\n\n\n  Data.prototype.updateDataManager = function (updateType, params, type, data, index) {\n    var _this = this;\n\n    this.parent.showSpinner();\n    var promise;\n    var actionArgs = {\n      requestType: type,\n      cancel: false,\n      addedRecords: params.addedRecords,\n      changedRecords: params.changedRecords,\n      deletedRecords: params.deletedRecords\n    };\n    this.eventPromise(actionArgs, this.query, index);\n    this.parent.trigger(events.actionComplete, actionArgs, function (offlineArgs) {\n      if (!offlineArgs.cancel) {\n        switch (updateType) {\n          case 'insert':\n            promise = _this.dataManager.insert(data, _this.getTable(), _this.getQuery());\n            break;\n\n          case 'update':\n            promise = _this.dataManager.update(_this.keyField, data, _this.getTable(), _this.getQuery());\n            break;\n\n          case 'delete':\n            promise = _this.dataManager.remove(_this.keyField, data, _this.getTable(), _this.getQuery());\n            break;\n\n          case 'batch':\n            promise = _this.dataManager.saveChanges(params, _this.keyField, _this.getTable(), _this.getQuery());\n            break;\n        }\n\n        if (_this.dataManager.dataSource.offline) {\n          if (!_this.isObservable) {\n            _this.kanbanData = _this.dataManager;\n            _this.parent.kanbanData = _this.dataManager.dataSource.json;\n\n            _this.refreshUI(offlineArgs, index);\n          }\n        } else {\n          promise.then(function () {\n            if (_this.parent.isDestroyed) {\n              return;\n            }\n\n            var dataManager = _this.getData(_this.getQuery());\n\n            dataManager.then(function (e) {\n              return _this.dataManagerSuccess(e, 'DataSourceChange', offlineArgs, index);\n            }).catch(function (e) {\n              return _this.dataManagerFailure(e);\n            });\n          }).catch(function (e) {\n            _this.dataManagerFailure(e);\n          });\n        }\n      }\n    });\n  };\n\n  Data.prototype.modifyArrayData = function (onLineData, e) {\n    if (onLineData.length === e.length) {\n      for (var i = 0; i < e.length; i++) {\n        onLineData[i] = extend(onLineData[i], e[i]);\n      }\n    }\n\n    return onLineData;\n  };\n  /**\n   * The function is used to refresh the UI once the data manager action is completed\n   *\n   * @param {ActionEventArgs} args Accepts the ActionEventArgs to refresh UI.\n   * @param {number} position Accepts the index to refresh UI.\n   * @returns {void}\n   */\n\n\n  Data.prototype.refreshUI = function (args, position) {\n    var _this = this;\n\n    this.parent.layoutModule.columnData = this.parent.layoutModule.getColumnCards();\n\n    if (this.parent.swimlaneSettings.keyField) {\n      this.parent.layoutModule.kanbanRows = this.parent.layoutModule.getRows();\n      this.parent.layoutModule.swimlaneData = this.parent.layoutModule.getSwimlaneCards();\n    }\n\n    args.addedRecords.forEach(function (data, index) {\n      if (_this.parent.swimlaneSettings.keyField && !data[_this.parent.swimlaneSettings.keyField]) {\n        data[_this.parent.swimlaneSettings.keyField] = '';\n      }\n\n      _this.parent.layoutModule.renderCardBasedOnIndex(data, position + index);\n    });\n    args.changedRecords.forEach(function (data) {\n      if (_this.parent.swimlaneSettings.keyField && !data[_this.parent.swimlaneSettings.keyField]) {\n        data[_this.parent.swimlaneSettings.keyField] = '';\n      }\n\n      _this.parent.layoutModule.removeCard(data);\n\n      _this.parent.layoutModule.renderCardBasedOnIndex(data, position);\n\n      if (_this.parent.layoutModule.isSelectedCard) {\n        _this.parent.actionModule.SingleCardSelection(data);\n      }\n\n      if (_this.parent.sortSettings.field && _this.parent.sortSettings.sortBy === 'Index' && _this.parent.sortSettings.direction === 'Descending' && position > 0) {\n        --position;\n      }\n    });\n    args.deletedRecords.forEach(function (data) {\n      _this.parent.layoutModule.removeCard(data);\n    });\n    this.parent.layoutModule.refresh();\n    this.parent.renderTemplates();\n    this.parent.notify(events.contentReady, {});\n    this.parent.trigger(events.dataBound, args, function () {\n      return _this.parent.hideSpinner();\n    });\n  };\n\n  return Data;\n}();\n\nexport { Data };","map":{"version":3,"sources":["C:/Users/khang/OneDrive/Tài liệu/JS/PersonalDashdoard/dashboard/node_modules/@syncfusion/ej2-kanban/src/kanban/base/data.js"],"names":["extend","DataManager","Query","Deferred","UrlAdaptor","events","Data","parent","dataState","isPending","resolver","isDataChanged","keyField","cardSettings","headerField","isObservable","initDataManager","dataSource","query","refreshDataManager","prototype","dataManager","kanbanData","getQuery","clone","getData","def","eventPromise","requestType","promise","executeQuery","setState","state","getStateEventArgument","adaptr","dm","url","adaptor","processQuery","data","JSON","parse","pvtData","args","index","_this","dataArgs","deff","undefined","action","editArgs_1","resolve","endEdit","cancelEdit","reject","trigger","dataSourceChanged","then","dataStateChange","addedRecords","forEach","push","changedRecords","changedRecord","cardObj","filter","deletedRecords","deletedRecord","findIndex","splice","catch","hideSpinner","getTable","fromTable","e","dataManagerSuccess","dataManagerFailure","type","offlineArgs","isDestroyed","resultData","result","Array","isArray","modifyArrayData","refreshUI","dataBinding","notify","dataReady","processedData","dataBound","actionFailure","error","updateDataManager","updateType","params","showSpinner","actionArgs","cancel","actionComplete","insert","update","remove","saveChanges","offline","json","onLineData","length","i","position","layoutModule","columnData","getColumnCards","swimlaneSettings","kanbanRows","getRows","swimlaneData","getSwimlaneCards","renderCardBasedOnIndex","removeCard","isSelectedCard","actionModule","SingleCardSelection","sortSettings","field","sortBy","direction","refresh","renderTemplates","contentReady"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { extend } from '@syncfusion/ej2-base';\nimport { DataManager, Query, Deferred, UrlAdaptor } from '@syncfusion/ej2-data';\nimport * as events from './constant';\n/**\n * Kanban data module\n */\nvar Data = /** @class */ (function () {\n    /**\n     * Constructor for data module\n     *\n     * @param {Kanban} parent Accepts the instance of the Kanban\n     */\n    function Data(parent) {\n        this.dataState = { isPending: false, resolver: null, isDataChanged: false };\n        this.parent = parent;\n        this.keyField = this.parent.cardSettings.headerField;\n        this.dataState = { isDataChanged: false };\n        this.isObservable = false;\n        this.initDataManager(parent.dataSource, parent.query);\n        this.refreshDataManager();\n    }\n    /**\n     * The function used to initialize dataManager` and query\n     *\n     * @param {Object[] | DataManager} dataSource Accepts the dataSource as collection of objects or Datamanager instance.\n     * @param {Query} query Accepts the query to process the data from collections.\n     * @returns {void}\n     * @private\n     */\n    Data.prototype.initDataManager = function (dataSource, query) {\n        this.dataManager = dataSource instanceof DataManager ? dataSource : new DataManager(dataSource);\n        this.query = query instanceof Query ? query : new Query();\n        this.kanbanData = new DataManager(this.parent.kanbanData);\n    };\n    /**\n     * The function used to generate updated Query from schedule model\n     *\n     * @returns {void}\n     * @private\n     */\n    Data.prototype.getQuery = function () {\n        return this.query.clone();\n    };\n    /**\n     * The function used to get dataSource by executing given Query\n     *\n     * @param  {Query} query - A Query that specifies to generate dataSource\n     * @returns {void}\n     * @private\n     */\n    Data.prototype.getData = function (query) {\n        if (this.parent.dataSource && 'result' in this.parent.dataSource) {\n            var def = this.eventPromise({ requestType: '' }, query);\n            this.isObservable = true;\n            return def.promise;\n        }\n        return this.dataManager.executeQuery(query);\n    };\n    Data.prototype.setState = function (state) {\n        return this.dataState = state;\n    };\n    Data.prototype.getStateEventArgument = function (query) {\n        var adaptr = new UrlAdaptor();\n        var dm = new DataManager({ url: '', adaptor: new UrlAdaptor });\n        var state = adaptr.processQuery(dm, query);\n        var data = JSON.parse(state.data);\n        return extend(data, state.pvtData);\n    };\n    Data.prototype.eventPromise = function (args, query, index) {\n        var _this = this;\n        var dataArgs = args;\n        var state = this.getStateEventArgument(query);\n        var def = new Deferred();\n        var deff = new Deferred();\n        if (args.requestType !== undefined && this.dataState.isDataChanged !== false) {\n            state.action = args;\n            if (args.requestType === 'cardChanged' || args.requestType === 'cardRemoved' || args.requestType === 'cardCreated') {\n                var editArgs_1 = args;\n                editArgs_1.promise = deff.promise;\n                editArgs_1.state = state;\n                editArgs_1.index = index;\n                this.setState({ isPending: true, resolver: deff.resolve });\n                dataArgs.endEdit = deff.resolve;\n                dataArgs.cancelEdit = deff.reject;\n                this.parent.trigger(events.dataSourceChanged, editArgs_1);\n                deff.promise.then(function () {\n                    _this.setState({ isPending: true, resolver: def.resolve });\n                    _this.parent.trigger(events.dataStateChange, state);\n                    editArgs_1.addedRecords.forEach(function (data) {\n                        _this.parent.kanbanData.push(data);\n                    });\n                    editArgs_1.changedRecords.forEach(function (changedRecord) {\n                        var cardObj = _this.parent.kanbanData.filter(function (data) {\n                            return data[_this.parent.cardSettings.headerField] === changedRecord[_this.parent.cardSettings.headerField];\n                        })[0];\n                        extend(cardObj, changedRecord);\n                    });\n                    editArgs_1.deletedRecords.forEach(function (deletedRecord) {\n                        var index = _this.parent.kanbanData.findIndex(function (data) {\n                            return data[_this.parent.cardSettings.headerField] === deletedRecord[_this.parent.cardSettings.headerField];\n                        });\n                        _this.parent.kanbanData.splice(index, 1);\n                    });\n                }).catch(function () { _this.parent.hideSpinner(); void 0; });\n            }\n            else {\n                this.setState({ isPending: true, resolver: def.resolve });\n                this.parent.trigger(events.dataStateChange, state);\n            }\n        }\n        else {\n            this.setState({});\n            def.resolve(this.parent.dataSource);\n        }\n        return def;\n    };\n    /**\n     * The function used to get the table name from the given Query\n     *\n     * @returns {string} Returns the table name.\n     * @private\n     */\n    Data.prototype.getTable = function () {\n        if (this.parent.query) {\n            var query = this.getQuery();\n            return query.fromTable;\n        }\n        else {\n            return null;\n        }\n    };\n    /**\n     * The function is used to send the request and get response from datamanager\n     *\n     * @returns {void}\n     * @private\n     */\n    Data.prototype.refreshDataManager = function () {\n        var _this = this;\n        var dataManager = this.getData(this.getQuery());\n        dataManager.then(function (e) { return _this.dataManagerSuccess(e); }).catch(function (e) { return _this.dataManagerFailure(e); });\n    };\n    /**\n     * The function is used to handle the success response from dataManager\n     *\n     * @param {ReturnType} e Accepts the dataManager success result\n     * @returns {void}\n     * @private\n     */\n    Data.prototype.dataManagerSuccess = function (e, type, offlineArgs, index) {\n        var _this = this;\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        if (type) {\n            var resultData = extend([], e.result, null, true);\n            this.parent.kanbanData = resultData;\n            if (offlineArgs.requestType === 'cardCreated') {\n                if (!Array.isArray(e)) {\n                    offlineArgs.addedRecords[0] = extend(offlineArgs.addedRecords[0], e);\n                }\n                else {\n                    this.modifyArrayData(offlineArgs.addedRecords, e);\n                }\n            }\n            else if (offlineArgs.requestType === 'cardChanged') {\n                if (!Array.isArray(e)) {\n                    offlineArgs.changedRecords[0] = extend(offlineArgs.changedRecords[0], e);\n                }\n                else {\n                    this.modifyArrayData(offlineArgs.changedRecords, e);\n                }\n            }\n            else if (offlineArgs.requestType === 'cardRemoved') {\n                if (!Array.isArray(e)) {\n                    offlineArgs.deletedRecords[0] = extend(offlineArgs.deletedRecords[0], e);\n                }\n                else {\n                    this.modifyArrayData(offlineArgs.deletedRecords, e);\n                }\n            }\n            this.refreshUI(offlineArgs, index);\n        }\n        else {\n            this.parent.trigger(events.dataBinding, e, function (args) {\n                var resultData = extend([], args.result, null, true);\n                _this.parent.kanbanData = resultData;\n                _this.parent.notify(events.dataReady, { processedData: resultData });\n                _this.parent.trigger(events.dataBound, null, function () { return _this.parent.hideSpinner(); });\n            });\n        }\n    };\n    /**\n     * The function is used to handle the failure response from dataManager\n     *\n     * @param {ReturnType} e Accepts the dataManager failure result\n     * @returns {void}\n     * @private\n     */\n    Data.prototype.dataManagerFailure = function (e) {\n        var _this = this;\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.trigger(events.actionFailure, { error: e }, function () { return _this.parent.hideSpinner(); });\n    };\n    /**\n     * The function is used to perform the insert, update, delete and batch actions in datamanager\n     *\n     * @param {string} updateType Accepts the update type action\n     * @param {SaveChanges} params Accepts the savechanges params\n     * @param {string} type Accepts the requestType as string\n     * @param {Object} data Accepts the data to perform crud action\n     * @param {number} index Accepts the index to refresh the data into UI\n     * @returns {void}\n     * @private\n     */\n    Data.prototype.updateDataManager = function (updateType, params, type, data, index) {\n        var _this = this;\n        this.parent.showSpinner();\n        var promise;\n        var actionArgs = {\n            requestType: type, cancel: false, addedRecords: params.addedRecords,\n            changedRecords: params.changedRecords, deletedRecords: params.deletedRecords\n        };\n        this.eventPromise(actionArgs, this.query, index);\n        this.parent.trigger(events.actionComplete, actionArgs, function (offlineArgs) {\n            if (!offlineArgs.cancel) {\n                switch (updateType) {\n                    case 'insert':\n                        promise = _this.dataManager.insert(data, _this.getTable(), _this.getQuery());\n                        break;\n                    case 'update':\n                        promise = _this.dataManager.update(_this.keyField, data, _this.getTable(), _this.getQuery());\n                        break;\n                    case 'delete':\n                        promise = _this.dataManager.remove(_this.keyField, data, _this.getTable(), _this.getQuery());\n                        break;\n                    case 'batch':\n                        promise = _this.dataManager.saveChanges(params, _this.keyField, _this.getTable(), _this.getQuery());\n                        break;\n                }\n                if (_this.dataManager.dataSource.offline) {\n                    if (!_this.isObservable) {\n                        _this.kanbanData = _this.dataManager;\n                        _this.parent.kanbanData = _this.dataManager.dataSource.json;\n                        _this.refreshUI(offlineArgs, index);\n                    }\n                }\n                else {\n                    promise.then(function () {\n                        if (_this.parent.isDestroyed) {\n                            return;\n                        }\n                        var dataManager = _this.getData(_this.getQuery());\n                        dataManager.then(function (e) { return _this.dataManagerSuccess(e, 'DataSourceChange', offlineArgs, index); }).catch(function (e) { return _this.dataManagerFailure(e); });\n                    }).catch(function (e) {\n                        _this.dataManagerFailure(e);\n                    });\n                }\n            }\n        });\n    };\n    Data.prototype.modifyArrayData = function (onLineData, e) {\n        if (onLineData.length === e.length) {\n            for (var i = 0; i < e.length; i++) {\n                onLineData[i] = extend(onLineData[i], e[i]);\n            }\n        }\n        return onLineData;\n    };\n    /**\n     * The function is used to refresh the UI once the data manager action is completed\n     *\n     * @param {ActionEventArgs} args Accepts the ActionEventArgs to refresh UI.\n     * @param {number} position Accepts the index to refresh UI.\n     * @returns {void}\n     */\n    Data.prototype.refreshUI = function (args, position) {\n        var _this = this;\n        this.parent.layoutModule.columnData = this.parent.layoutModule.getColumnCards();\n        if (this.parent.swimlaneSettings.keyField) {\n            this.parent.layoutModule.kanbanRows = this.parent.layoutModule.getRows();\n            this.parent.layoutModule.swimlaneData = this.parent.layoutModule.getSwimlaneCards();\n        }\n        args.addedRecords.forEach(function (data, index) {\n            if (_this.parent.swimlaneSettings.keyField && !data[_this.parent.swimlaneSettings.keyField]) {\n                data[_this.parent.swimlaneSettings.keyField] = '';\n            }\n            _this.parent.layoutModule.renderCardBasedOnIndex(data, position + index);\n        });\n        args.changedRecords.forEach(function (data) {\n            if (_this.parent.swimlaneSettings.keyField && !data[_this.parent.swimlaneSettings.keyField]) {\n                data[_this.parent.swimlaneSettings.keyField] = '';\n            }\n            _this.parent.layoutModule.removeCard(data);\n            _this.parent.layoutModule.renderCardBasedOnIndex(data, position);\n            if (_this.parent.layoutModule.isSelectedCard) {\n                _this.parent.actionModule.SingleCardSelection(data);\n            }\n            if (_this.parent.sortSettings.field && _this.parent.sortSettings.sortBy === 'Index'\n                && _this.parent.sortSettings.direction === 'Descending' && position > 0) {\n                --position;\n            }\n        });\n        args.deletedRecords.forEach(function (data) {\n            _this.parent.layoutModule.removeCard(data);\n        });\n        this.parent.layoutModule.refresh();\n        this.parent.renderTemplates();\n        this.parent.notify(events.contentReady, {});\n        this.parent.trigger(events.dataBound, args, function () { return _this.parent.hideSpinner(); });\n    };\n    return Data;\n}());\nexport { Data };\n"]},"metadata":{},"sourceType":"module"}